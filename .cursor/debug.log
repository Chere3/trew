{"location":"semantic-memory.ts:getUserSemanticMemory:entry","message":"getUserSemanticMemory called","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF"},"timestamp":1769301333971,"sessionId":"debug-session","runId":"run1","hypothesisId":"C"}
{"location":"semantic-memory.ts:getUserSemanticMemory:success","message":"Memory retrieved","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","factCount":3,"factKeys":["name","likes_tacos","full_name"]},"timestamp":1769301333973,"sessionId":"debug-session","runId":"run1","hypothesisId":"C"}
{"location":"generate/route.ts:userFacts-loaded","message":"User facts loaded for generate","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","hasFacts":true,"factCount":3,"factKeys":["name","likes_tacos","full_name"]},"timestamp":1769301333975,"sessionId":"debug-session","runId":"run1","hypothesisId":"D"}
{"location":"system-prompt.ts:getSystemPrompt:entry","message":"getSystemPrompt called","data":{"hasSummary":false,"hasUserFacts":true,"factCount":3},"timestamp":1769301334943,"sessionId":"debug-session","runId":"run1","hypothesisId":"D"}
{"location":"system-prompt.ts:getSystemPrompt:injecting-facts","message":"Injecting user facts into prompt","data":{"factCount":3,"factKeys":["name","likes_tacos","full_name"],"formattedFacts":"- name: Diego\n- likes_tacos: true\n- full_name: Diego Romero"},"timestamp":1769301334945,"sessionId":"debug-session","runId":"run1","hypothesisId":"D"}
{"location":"system-prompt.ts:getSystemPrompt:user-profile-section","message":"User profile section created","data":{"sectionLength":572,"sectionContent":"\n\n<user_profile>\nUSER INFORMATION - USE THIS WHEN ANSWERING QUESTIONS ABOUT THE USER:\n\n- name: Diego\n- likes_tacos: true\n- full_name: Diego Romero\n\nMANDATORY INSTRUCTIONS:\n- When the user asks \"What is my name?\" or \"Do you know my name?\", answer using the name from above\n- When the user asks about their preferences, use the information from above\n- When the user asks about any personal details, use the information from above\n- NEVER say you don't know information that is listed above\n- This information is ALWAYS available to you in every conversation\n</user_profile>"},"timestamp":1769301334947,"sessionId":"debug-session","runId":"run1","hypothesisId":"E"}
{"location":"system-prompt.ts:getSystemPrompt:final","message":"Final system prompt","data":{"promptLength":4221,"hasUserProfile":true,"userProfileIndex":353,"userProfileEndIndex":908},"timestamp":1769301334949,"sessionId":"debug-session","runId":"run1","hypothesisId":"E"}
{"location":"generate/route.ts:system-prompt","message":"System prompt generated","data":{"hasSummary":false,"hasUserFacts":true,"factCount":3,"promptLength":4221,"containsUserProfile":true,"userProfileIndex":353,"userProfileEndIndex":908,"fullSystemPrompt":"<identity>\nYou are a helpful, harmless, and honest AI assistant operating within the Trew chat platform. Your primary goal is to assist users by providing accurate, useful, and well-reasoned responses to their questions and requests. You have access to the user's profile information which you must use when answering questions about them.\n</identity>\n\n<user_profile>\nUSER INFORMATION - USE THIS WHEN ANSWERING QUESTIONS ABOUT THE USER:\n\n- name: Diego\n- likes_tacos: true\n- full_name: Diego Romero\n\nMANDATORY INSTRUCTIONS:\n- When the user asks \"What is my name?\" or \"Do you know my name?\", answer using the name from above\n- When the user asks about their preferences, use the information from above\n- When the user asks about any personal details, use the information from above\n- NEVER say you don't know information that is listed above\n- This information is ALWAYS available to you in every conversation\n</user_profile>\n\n<instructions>\n0. **USER PROFILE AVAILABLE**: The user profile information is provided above in the <user_profile> section. You MUST use this information when the user asks about themselves. For example, if the profile shows their name, and they ask \"What is my name?\", you MUST tell them their name from the profile.\n1. **Be Helpful**: Provide clear, accurate, and comprehensive answers. When appropriate, break down complex topics into understandable parts.\n\n2. **Be Honest**: If you don't know something or are uncertain, clearly state that. Do not make up information or present speculation as fact.\n\n3. **Be Harmless**: Avoid generating content that could cause harm, including but not limited to:\n   - Illegal activities or instructions\n   - Dangerous or harmful advice\n   - Content that violates privacy or safety\n   - Discriminatory or offensive material\n\n4. **Follow User Preferences**: Adapt your communication style to match the user's needs. If they ask for concise answers, be brief. If they need detailed explanations, provide them.\n\n5. **Use Current Information**: Today's date is Saturday, January 24, 2026. For time-sensitive queries, use this date as your reference point. Be aware that your training data has a knowledge cutoff, and you should acknowledge when information may be outdated.\n\n6. **Provide Context**: When relevant, explain your reasoning or provide sources for factual claims when possible.\n\n7. **Format Appropriately**: Use clear formatting (markdown, lists, code blocks) when it improves readability. Structure longer responses with headings and sections.\n\n8. **Remember User Information**: When user profile information is provided in the <user_profile> section, you MUST use it to answer questions about the user. If the user asks \"What is my name?\" or \"Do you know my name?\" or similar questions about their profile, answer using the information from the user_profile section. For example, if the user_profile shows \"name: Diego\", and the user asks \"What is my name?\", you MUST respond with \"Your name is Diego\" or similar. Never say you don't know information that is explicitly provided in the user_profile.\n</instructions>\n\n<constraints>\n1. **Safety First**: Never provide instructions for illegal activities, creating harmful content, or violating privacy.\n\n2. **Accuracy**: If you're uncertain about information, say so. It's better to admit uncertainty than to provide incorrect information.\n\n3. **Respect Boundaries**: If a request makes you uncomfortable or seems inappropriate, politely decline and explain why if helpful.\n\n4. **Response Format**: \n   - Use natural, conversational language\n   - Format code with appropriate syntax highlighting\n   - Use markdown for structure when helpful\n   - Keep responses focused and relevant\n\n5. **Knowledge Limitations**: Acknowledge when you're working with potentially outdated information or when you lack specific knowledge about recent events.\n</constraints>\n\n<context>\nYou are operating within the Trew chat platform, which provides access to multiple AI models through a unified interface. Users may switch between different models, and each model has its own strengths and characteristics. Your responses should be consistent and helpful regardless of which underlying model is being used.\n</context>"},"timestamp":1769301334950,"sessionId":"debug-session","runId":"run2","hypothesisId":"F"}
{"location":"generate/route.ts:profile-message-injected","message":"User profile injected as message","data":{"factCount":3,"profileMessageLength":244,"messageCount":1},"timestamp":1769301334952,"sessionId":"debug-session","runId":"run3","hypothesisId":"H"}
{"location":"generate/route.ts:api-request","message":"About to send request to OpenRouter","data":{"model":"moonshotai/kimi-k2-thinking","hasSystemPrompt":true,"systemPromptLength":4221,"containsUserProfile":true,"messageCount":2,"hasProfileMessage":true,"requestBodyPreview":"{\"model\":\"moonshotai/kimi-k2-thinking\",\"system\":\"<identity>\\nYou are a helpful, harmless, and honest AI assistant operating within the Trew chat platform. Your primary goal is to assist users by providing accurate, useful, and well-reasoned responses to their questions and requests. You have access to the user's profile information which you must use when answering questions about them.\\n</identity>\\n\\n<user_profile>\\nUSER INFORMATION - USE THIS WHEN ANSWERING QUESTIONS ABOUT THE USER:\\n\\n- name: Diego\\n- likes_tacos: true\\n- full_name: Diego Romero\\n\\nMANDATORY INSTRUCTIONS:\\n- When the user asks \\\"What is my name?\\\" or \\\"Do you know my name?\\\", answer using the name from above\\n- When the user asks about their preferences, use the information from above\\n- When the user asks about any personal details, use the information from above\\n- NEVER say you don't know information that is listed above\\n- This information is ALWAYS available to you in every conversation\\n</user_profile>\\n\\n<in"},"timestamp":1769301334953,"sessionId":"debug-session","runId":"run2","hypothesisId":"F"}
{"location":"generate/route.ts:first-chunk","message":"First response chunk received","data":{"firstChunk":"Tu","hasName":false,"hasProfileInfo":false},"timestamp":1769301337100,"sessionId":"debug-session","runId":"run3","hypothesisId":"I"}
{"location":"generate/route.ts:final-response","message":"Final assistant response","data":{"responseLength":580,"first200Chars":"<think> The user asks \"cual es mi nombre?\" which is Spanish for \"What is my name?\".\n\nI have the user profile information:\n- name: Diego\n- likes_tacos: true\n- full_name: Diego Romero\n\nThe user is askin","containsName":true,"containsProfileInfo":true},"timestamp":1769301337259,"sessionId":"debug-session","runId":"run3","hypothesisId":"I"}
{"location":"generate/route.ts:extract-start","message":"Starting fact extraction","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","messageCount":1},"timestamp":1769301337270,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:extractFacts:entry","message":"extractFacts called","data":{"messageCount":1,"hasExistingFacts":true,"existingFactKeys":["name","likes_tacos","full_name"]},"timestamp":1769301337272,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:extractFacts:raw-response","message":"Raw API response received","data":{"contentLength":179,"contentPreview":"{\n  \"facts\": {\n    \"name\": \"Diego\",\n    \"full_name\": \"Diego Romero\",\n    \"likes_tacos\": true\n  },\n  \"scores\": {\n    \"name\": 0.9,\n    \"full_name\": 0.9,\n    \"likes_tacos\": 0.8\n  }\n}"},"timestamp":1769301339187,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:extractFacts:before-parse","message":"About to parse JSON","data":{"jsonContentLength":179,"jsonContentPreview":"{\n  \"facts\": {\n    \"name\": \"Diego\",\n    \"full_name\": \"Diego Romero\",\n    \"likes_tacos\": true\n  },\n  \"scores\": {\n    \"name\": 0.9,\n    \"full_name\": 0.9,\n    \"likes_tacos\": 0.8\n  }\n}"},"timestamp":1769301339190,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:extractFacts:success","message":"extractFacts completed","data":{"factCount":3,"factKeys":["name","full_name","likes_tacos"],"scores":{"name":0.9,"full_name":0.9,"likes_tacos":0.8}},"timestamp":1769301339191,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"generate/route.ts:extract-result","message":"Fact extraction completed","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","extractedCount":3,"extractedKeys":["name","full_name","likes_tacos"],"scores":{"name":0.9,"full_name":0.9,"likes_tacos":0.8}},"timestamp":1769301339192,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:shouldSaveFact","message":"shouldSaveFact check","data":{"factKey":"name","score":0.9,"threshold":0.7,"shouldSave":true},"timestamp":1769301339193,"sessionId":"debug-session","runId":"run1","hypothesisId":"B"}
{"location":"semantic-memory.ts:shouldSaveFact","message":"shouldSaveFact check","data":{"factKey":"full_name","score":0.9,"threshold":0.7,"shouldSave":true},"timestamp":1769301339194,"sessionId":"debug-session","runId":"run1","hypothesisId":"B"}
{"location":"semantic-memory.ts:shouldSaveFact","message":"shouldSaveFact check","data":{"factKey":"likes_tacos","score":0.8,"threshold":0.7,"shouldSave":true},"timestamp":1769301339195,"sessionId":"debug-session","runId":"run1","hypothesisId":"B"}
{"location":"generate/route.ts:filter-result","message":"Facts filtered by threshold","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","extractedCount":3,"savedCount":3,"savedKeys":["name","full_name","likes_tacos"],"threshold":0.7},"timestamp":1769301339196,"sessionId":"debug-session","runId":"run1","hypothesisId":"B"}
{"location":"semantic-memory.ts:updateUserSemanticMemory:entry","message":"updateUserSemanticMemory called","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","factCount":3,"factKeys":["name","likes_tacos","full_name"]},"timestamp":1769301339197,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
{"location":"semantic-memory.ts:updateUserSemanticMemory:success","message":"Memory saved to DB","data":{"userId":"je5Aneu7DOqL1bsnDJ19EcGnpTiwmvWF","factCount":3},"timestamp":1769301339205,"sessionId":"debug-session","runId":"run1","hypothesisId":"A"}
